<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@flashbots/ethers-provider-bundle</title>
	<meta name="description" content="Documentation for @flashbots/ethers-provider-bundle">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@flashbots/ethers-provider-bundle</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>@flashbots/ethers-provider-bundle</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#ethers-provider-flashbots-bundle" id="ethers-provider-flashbots-bundle" style="color: inherit; text-decoration: none;">
					<h1>ethers-provider-flashbots-bundle</h1>
				</a>
				<p><img src="https://github.com/sambacha/ethers-provider-flashbots-bundle/workflows/nodejs/badge.svg" alt="nodejs">
					<img src="https://github.com/sambacha/ethers-provider-flashbots-bundle/workflows/lint/badge.svg" alt="lint">
				<img src="https://github.com/sambacha/ethers-provider-flashbots-bundle/workflows/typedoc/badge.svg" alt="typedoc"></p>
				<p>Contains the <code>FlashbotsBundleProvider</code> ethers.js provider to provide high-level access to eth_sendBundle rpc endpoint.</p>
				<p>Flashbots-enabled relays and miners will expose a single jsonrpc endpoint: <code>eth_sendBundle</code>. Since this is a brand-new, non-standard endpoint, ethers.js and other libraries do not natively support these requests (like <code>getTransactionCount</code>). In order to interact with <code>eth_sendBundle</code>, you will also need access to another full-featured endpoint for nonce-calculation, gas estimation, and transaction status.</p>
				<p>This library is not a fully functional ethers.js implementation, just a simple provider class, designed to interact with your existing ethers.js v5 module.</p>
				<p>You can pass in a generic ethers.js provider to the flashbots provider in the constructor:</p>
				<pre><code><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">NETWORK_INFO</span><span style="color: #000000"> = {</span><span style="color: #001080">chainId:</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">ensAddress:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;&#039;</span><span style="color: #000000">, </span><span style="color: #001080">name:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;mainnet&#039;</span><span style="color: #000000">}</span>

<span style="color: #008000">// Standard json rpc provider directly from ethers.js</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">provider</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">providers</span><span style="color: #000000">.</span><span style="color: #267F99">JsonRpcProvider</span><span style="color: #000000">({</span><span style="color: #001080">url:</span><span style="color: #000000"> </span><span style="color: #0070C1">ETHEREUM_RPC_URL</span><span style="color: #000000">}, </span><span style="color: #0070C1">NETWORK_INFO</span><span style="color: #000000">)</span>

<span style="color: #008000">// flashbots provider requires passing in a standard provider</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">flashbotsProvider</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">FlashbotsBundleProvider</span><span style="color: #000000">.</span><span style="color: #795E26">create</span><span style="color: #000000">(</span><span style="color: #001080">provider</span><span style="color: #000000">, </span><span style="color: #001080">flashbotsApiKey</span><span style="color: #000000">, </span><span style="color: #001080">flashbotsSecret</span><span style="color: #000000">)</span>
</code></pre>
				<p>The flashbotsProvider provides the sendBundle function:</p>
				<pre><code><span style="color: #001080">flashbotsProvider</span><span style="color: #000000">.</span><span style="color: #795E26">sendBundle</span><span style="color: #000000">(</span><span style="color: #001080">bundledTransactions</span><span style="color: #000000">: </span><span style="color: #267F99">Array</span><span style="color: #000000">&lt;</span><span style="color: #001080">FlashbotsBundleTransaction</span><span style="color: #000000"> | </span><span style="color: #001080">FlashbotsBundleRawTransaction</span><span style="color: #000000">&gt;, </span><span style="color: #001080">targetBlockNumber</span><span style="color: #000000">: </span><span style="color: #001080">number</span><span style="color: #000000">)</span>
<span style="color: #000000">    </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">Promise</span><span style="color: #000000">&lt;</span><span style="color: #001080">FlashbotsTransactionResponse</span><span style="color: #000000">&gt;</span>
</code></pre>
				<a href="#example" id="example" style="color: inherit; text-decoration: none;">
					<h2>Example</h2>
				</a>
				<pre><code><span style="color: #008000">// Using the map below ships two different bundles, targeting the next two blocks</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">blockNumber</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">provider</span><span style="color: #000000">.</span><span style="color: #795E26">getBlockNumber</span><span style="color: #000000">()</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">minTimestamp</span><span style="color: #000000"> = (</span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">provider</span><span style="color: #000000">.</span><span style="color: #795E26">getBlock</span><span style="color: #000000">(</span><span style="color: #001080">blockNumber</span><span style="color: #000000">)).</span><span style="color: #001080">timestamp</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">maxTimestamp</span><span style="color: #000000"> = </span><span style="color: #001080">minTimestamp</span><span style="color: #000000"> + </span><span style="color: #098658">120</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">bundlePromises</span><span style="color: #000000"> = </span><span style="color: #001080">_</span><span style="color: #000000">.</span><span style="color: #795E26">map</span><span style="color: #000000">([</span><span style="color: #001080">blockNumber</span><span style="color: #000000"> + </span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">blockNumber</span><span style="color: #000000"> + </span><span style="color: #098658">2</span><span style="color: #000000">], </span><span style="color: #001080">targetBlockNumber</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span>
<span style="color: #000000">  </span><span style="color: #0000FF">this</span><span style="color: #000000">.</span><span style="color: #001080">flashbotsProvider</span><span style="color: #000000">.</span><span style="color: #795E26">sendBundle</span><span style="color: #000000">(</span>
<span style="color: #000000">    [</span>
<span style="color: #000000">      {</span>
<span style="color: #000000">        </span><span style="color: #001080">signedTransaction:</span><span style="color: #000000"> </span><span style="color: #0070C1">SIGNED_ORACLE_UPDATE_FROM_PENDING_POOL</span><span style="color: #000000"> </span><span style="color: #008000">// serialized signed transaction hex</span>
<span style="color: #000000">      },</span>
<span style="color: #000000">      {</span>
<span style="color: #000000">        </span><span style="color: #001080">signer:</span><span style="color: #000000"> </span><span style="color: #001080">wallet</span><span style="color: #000000">, </span><span style="color: #008000">// ethers signer</span>
<span style="color: #000000">        </span><span style="color: #001080">transaction:</span><span style="color: #000000"> </span><span style="color: #001080">transaction</span><span style="color: #000000"> </span><span style="color: #008000">// ethers populated transaction object</span>
<span style="color: #000000">      }</span>
<span style="color: #000000">    ],</span>
<span style="color: #000000">    </span><span style="color: #001080">targetBlockNumber</span><span style="color: #000000">, </span><span style="color: #008000">// block number at which this bundle is valid</span>
<span style="color: #000000">    {</span>
<span style="color: #000000">      </span><span style="color: #001080">minTimestamp</span><span style="color: #000000">, </span><span style="color: #008000">// optional minimum timestamp at which this bundle is valid (inclusive)</span>
<span style="color: #000000">      </span><span style="color: #001080">maxTimestamp</span><span style="color: #000000"> </span><span style="color: #008000">// optional maximum timestamp at which this bundle is valid (inclusive)</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">  )</span>
<span style="color: #000000">)</span>
</code></pre>
				<a href="#bundledtransactions" id="bundledtransactions" style="color: inherit; text-decoration: none;">
					<h2>bundledTransactions</h2>
				</a>
				<p>A Flashbots bundle consists of one or more transactions in strict order to be relayed to the miner directly. While the miner requires signed transaction, <code>sendBundle()</code> can receive a mix of pre-signed transaction and <code>TransactionRequest</code> + <code>Signer</code> (wallet) objects</p>
				<p>These bundles can pay the miner either via gas fees <em>OR</em> via <code>block.coinbase.transfer(minerReward)</code></p>
				<a href="#targetblocknumber" id="targetblocknumber" style="color: inherit; text-decoration: none;">
					<h2>targetBlockNumber</h2>
				</a>
				<p>The only block number for which the bundle is to be considered valid. If you would like more than one block to be targeted, submit multiple rpc calls targeting each specific block. This value should be higher than the value of getBlockNumber(). Submitting a bundle with a target block number of the current block, or earlier, is a no-op.</p>
				<a href="#flashbotstransactionresponse" id="flashbotstransactionresponse" style="color: inherit; text-decoration: none;">
					<h2>FlashbotsTransactionResponse</h2>
				</a>
				<p>A high-level object which contains metadata available at transaction submission time, as well as the following functions which can wait, track, and simulate the bundle&#39;s behavior</p>
				<ul>
					<li>receipts() - Returns promise of an array of transaction receipts corresponding to the transaction hashes that were relayed as part of the bundle. Will not wait for block to be mined; could return incomplete information</li>
					<li>wait() - Returns a promise which will wait for target block number to be reched <em>OR</em> one of the transactions to become invalid due to nonce-issues (including, but not limited to, one of the transactions from you bundle being included too early). Returns the wait resolution as a status enum</li>
					<li>simulate() - Returns a promise of the transaction simulation, once the proper block height has been reached. Use this function to troubleshoot failing bundles and verify miner profitability</li>
				</ul>
				<a href="#how-to-run-demots" id="how-to-run-demots" style="color: inherit; text-decoration: none;">
					<h2>How to run demo.ts</h2>
				</a>
				<p>Included is a simple demo of how to construct the FlashbotsProvider with api key authentication and submit a [non-functional] bundle. This will not yield any mev, but could serve as a sample initialization to help integrate into your own functional searcher.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/index.html">index</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>