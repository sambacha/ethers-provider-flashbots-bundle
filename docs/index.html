<!DOCTYPE html>
<html class="default no-js">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>@flashbots/ethers-provider-bundle</title>
    <meta
      name="description"
      content="Documentation for @flashbots/ethers-provider-bundle"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="assets/css/main.css" />
  </head>
  <body>
    <header>
      <div class="tsd-page-toolbar">
        <div class="container">
          <div class="table-wrap">
            <div
              class="table-cell"
              id="tsd-search"
              data-index="assets/js/search.json"
              data-base="."
            >
              <div class="field">
                <label
                  for="tsd-search-field"
                  class="tsd-widget search no-caption"
                  >Search</label
                >
                <input id="tsd-search-field" type="text" />
              </div>
              <ul class="results">
                <li class="state loading">Preparing search index...</li>
                <li class="state failure">The search index is not available</li>
              </ul>
              <a href="index.html" class="title"
                >@flashbots/ethers-provider-bundle</a
              >
            </div>
            <div class="table-cell" id="tsd-widgets">
              <div id="tsd-filter">
                <a
                  href="#"
                  class="tsd-widget options no-caption"
                  data-toggle="options"
                  >Options</a
                >
                <div class="tsd-filter-group">
                  <div class="tsd-select" id="tsd-filter-visibility">
                    <span class="tsd-select-label">All</span>
                    <ul class="tsd-select-list">
                      <li data-value="public">Public</li>
                      <li data-value="protected">Public/Protected</li>
                      <li data-value="private" class="selected">All</li>
                    </ul>
                  </div>
                  <input type="checkbox" id="tsd-filter-inherited" checked />
                  <label class="tsd-widget" for="tsd-filter-inherited"
                    >Inherited</label
                  >
                  <input type="checkbox" id="tsd-filter-externals" checked />
                  <label class="tsd-widget" for="tsd-filter-externals"
                    >Externals</label
                  >
                  <input type="checkbox" id="tsd-filter-only-exported" />
                  <label class="tsd-widget" for="tsd-filter-only-exported"
                    >Only exported</label
                  >
                </div>
              </div>
              <a href="#" class="tsd-widget menu no-caption" data-toggle="menu"
                >Menu</a
              >
            </div>
          </div>
        </div>
      </div>
      <div class="tsd-page-title">
        <div class="container">
          <ul class="tsd-breadcrumb">
            <li>
              <a href="globals.html">Globals</a>
            </li>
          </ul>
          <h1>@flashbots/ethers-provider-bundle</h1>
        </div>
      </div>
    </header>
    <div class="container container-main">
      <div class="row">
        <div class="col-8 col-content">
          <div class="tsd-panel tsd-typography">
            <a
              href="#ethers-provider-flashbots-bundle"
              id="ethers-provider-flashbots-bundle"
              style="color: inherit; text-decoration: none;"
            >
              <h1>ethers-provider-flashbots-bundle</h1>
            </a>
            <p>
              Contains the <code>FlashbotsBundleProvider</code> ethers.js
              provider to provide high-level access to eth_sendBundle rpc
              endpoint.
            </p>
            <p>
              Flashbots-enabled relays and miners will expose a single jsonrpc
              endpoint: <code>eth_sendBundle</code>. Since this is a brand-new,
              non-standard endpoint, ethers.js and other libraries do not
              natively support these requests (like
              <code>getTransactionCount</code>). In order to interact with
              <code>eth_sendBundle</code>, you will also need access to another
              full-featured endpoint for nonce-calculation, gas estimation, and
              transaction status.
            </p>
            <p>
              This library is not a fully functional ethers.js implementation,
              just a simple provider class, designed to interact with your
              existing ethers.js v5 module.
            </p>
            <p>
              You can pass in a generic ethers.js provider to the flashbots
              provider in the constructor:
            </p>
            <pre><code><span class="hljs-keyword">const</span> NETWORK_INFO = {chainId: <span class="hljs-number">1</span>, ensAddress: <span class="hljs-string">&#x27;&#x27;</span>, name: <span class="hljs-string">&#x27;mainnet&#x27;</span>}

<span class="hljs-comment">// Standard json rpc provider directly from ethers.js </span>
<span class="hljs-keyword">const</span> provider = <span class="hljs-keyword">new</span> providers.JsonRpcProvider({url: ETHEREUM_RPC_URL}, NETWORK_INFO)

<span class="hljs-comment">// flashbots provider requires passing in a standard provider</span>
<span class="hljs-keyword">const</span> flashbotsProvider = <span class="hljs-keyword">await</span> FlashbotsBundleProvider.create(provider, flashbotsApiKey, flashbotsSecret)</code></pre>
            <p>The flashbotsProvider provides the sendBundle function:</p>
            <pre><code>flashbotsProvider.send<span class="hljs-constructor">Bundle(<span class="hljs-params">bundledTransactions</span>: Array&lt;FlashbotsBundleTransaction | FlashbotsBundleRawTransaction&gt;, <span class="hljs-params">targetBlockNumber</span>: <span class="hljs-params">number</span>)</span>
    =&gt; Promise&lt;FlashbotsTransactionResponse&gt;</code></pre>
            <a
              href="#example"
              id="example"
              style="color: inherit; text-decoration: none;"
            >
              <h2>Example</h2>
            </a>
            <pre><code><span class="hljs-comment">// Using the map below ships two different bundles, targeting the next two blocks</span>
<span class="hljs-keyword">const</span> blockNumber = <span class="hljs-keyword">await</span> provider.getBlockNumber()
<span class="hljs-keyword">const</span> minTimestamp = (<span class="hljs-keyword">await</span> provider.getBlock(blockNumber)).timestamp
<span class="hljs-keyword">const</span> maxTimestamp = minTimestamp + <span class="hljs-number">120</span>
<span class="hljs-keyword">const</span> bundlePromises = _.map([blockNumber + <span class="hljs-number">1</span>, blockNumber + <span class="hljs-number">2</span>], <span class="hljs-function"><span class="hljs-params">targetBlockNumber</span> =&gt;</span>
  <span class="hljs-built_in">this</span>.flashbotsProvider.sendBundle(
    [
      {
        <span class="hljs-attr">signedTransaction</span>: SIGNED_ORACLE_UPDATE_FROM_PENDING_POOL <span class="hljs-comment">// serialized signed transaction hex</span>
      },
      {
        <span class="hljs-attr">signer</span>: wallet, <span class="hljs-comment">// ethers signer</span>
        <span class="hljs-attr">transaction</span>: transaction <span class="hljs-comment">// ethers populated transaction object</span>
      }
    ],
    targetBlockNumber, <span class="hljs-comment">// block number at which this bundle is valid</span>
    {
      minTimestamp, <span class="hljs-comment">// optional minimum timestamp at which this bundle is valid (inclusive)</span>
      maxTimestamp <span class="hljs-comment">// optional maximum timestamp at which this bundle is valid (inclusive)</span>
    }
  )
)</code></pre>
            <a
              href="#bundledtransactions"
              id="bundledtransactions"
              style="color: inherit; text-decoration: none;"
            >
              <h2>bundledTransactions</h2>
            </a>
            <p>
              A Flashbots bundle consists of one or more transactions in strict
              order to be relayed to the miner directly. While the miner
              requires signed transaction, <code>sendBundle()</code> can receive
              a mix of pre-signed transaction and
              <code>TransactionRequest</code> + <code>Signer</code> (wallet)
              objects
            </p>
            <p>
              These bundles can pay the miner either via gas fees
              <em>OR</em> via <code>block.coinbase.transfer(minerReward)</code>
            </p>
            <a
              href="#targetblocknumber"
              id="targetblocknumber"
              style="color: inherit; text-decoration: none;"
            >
              <h2>targetBlockNumber</h2>
            </a>
            <p>
              The only block number for which the bundle is to be considered
              valid. If you would like more than one block to be targeted,
              submit multiple rpc calls targeting each specific block. This
              value should be higher than the value of getBlockNumber().
              Submitting a bundle with a target block number of the current
              block, or earlier, is a no-op.
            </p>
            <a
              href="#flashbotstransactionresponse"
              id="flashbotstransactionresponse"
              style="color: inherit; text-decoration: none;"
            >
              <h2>FlashbotsTransactionResponse</h2>
            </a>
            <p>
              A high-level object which contains metadata available at
              transaction submission time, as well as the following functions
              which can wait, track, and simulate the bundle&#39;s behavior
            </p>
            <ul>
              <li>
                receipts() - Returns promise of an array of transaction receipts
                corresponding to the transaction hashes that were relayed as
                part of the bundle. Will not wait for block to be mined; could
                return incomplete information
              </li>
              <li>
                wait() - Returns a promise which will wait for target block
                number to be reched <em>OR</em> one of the transactions to
                become invalid due to nonce-issues (including, but not limited
                to, one of the transactions from you bundle being included too
                early). Returns the wait resolution as a status enum
              </li>
              <li>
                simulate() - Returns a promise of the transaction simulation,
                once the proper block height has been reached. Use this function
                to troubleshoot failing bundles and verify miner profitability
              </li>
            </ul>
            <a
              href="#how-to-run-demots"
              id="how-to-run-demots"
              style="color: inherit; text-decoration: none;"
            >
              <h2>How to run demo.ts</h2>
            </a>
            <p>
              Included is a simple demo of how to construct the
              FlashbotsProvider with api key authentication and submit a
              [non-functional] bundle. This will not yield any mev, but could
              serve as a sample initialization to help integrate into your own
              functional searcher.
            </p>
          </div>
        </div>
        <div class="col-4 col-menu menu-sticky-wrap menu-highlight">
          <nav class="tsd-navigation primary">
            <ul>
              <li class="globals">
                <a href="globals.html"><em>Globals</em></a>
              </li>
            </ul>
          </nav>
          <nav class="tsd-navigation secondary menu-sticky">
            <ul class="before-current">
              <li class="tsd-kind-enum">
                <a
                  href="enums/flashbotsbundleresolution.html"
                  class="tsd-kind-icon"
                  >Flashbots<wbr />Bundle<wbr />Resolution</a
                >
              </li>
              <li class="tsd-kind-class">
                <a
                  href="classes/flashbotsbundleprovider.html"
                  class="tsd-kind-icon"
                  >Flashbots<wbr />Bundle<wbr />Provider</a
                >
              </li>
              <li class="tsd-kind-interface">
                <a
                  href="interfaces/flashbotsbundlerawtransaction.html"
                  class="tsd-kind-icon"
                  >Flashbots<wbr />Bundle<wbr />Raw<wbr />Transaction</a
                >
              </li>
              <li class="tsd-kind-interface">
                <a
                  href="interfaces/flashbotsbundletransaction.html"
                  class="tsd-kind-icon"
                  >Flashbots<wbr />Bundle<wbr />Transaction</a
                >
              </li>
              <li class="tsd-kind-interface">
                <a href="interfaces/flashbotsoptions.html" class="tsd-kind-icon"
                  >Flashbots<wbr />Options</a
                >
              </li>
              <li class="tsd-kind-interface">
                <a
                  href="interfaces/flashbotstransactionresponse.html"
                  class="tsd-kind-icon"
                  >Flashbots<wbr />Transaction<wbr />Response</a
                >
              </li>
              <li class="tsd-kind-interface">
                <a
                  href="interfaces/simulationresponse.html"
                  class="tsd-kind-icon"
                  >Simulation<wbr />Response</a
                >
              </li>
              <li class="tsd-kind-interface">
                <a
                  href="interfaces/transactionaccountnonce.html"
                  class="tsd-kind-icon"
                  >Transaction<wbr />Account<wbr />Nonce</a
                >
              </li>
              <li class="tsd-kind-variable">
                <a
                  href="globals.html#default_flashbots_relay"
                  class="tsd-kind-icon"
                  >DEFAULT_<wbr />FLASHBOTS_<wbr />RELAY</a
                >
              </li>
              <li class="tsd-kind-variable">
                <a href="globals.html#ethereum_rpc_url" class="tsd-kind-icon"
                  >ETHEREUM_<wbr />RPC_<wbr />URL</a
                >
              </li>
              <li class="tsd-kind-variable">
                <a href="globals.html#flashbots_key_id" class="tsd-kind-icon"
                  >FLASHBOTS_<wbr />KEY_<wbr />ID</a
                >
              </li>
              <li class="tsd-kind-variable">
                <a href="globals.html#flashbots_secret" class="tsd-kind-icon"
                  >FLASHBOTS_<wbr />SECRET</a
                >
              </li>
              <li class="tsd-kind-variable">
                <a href="globals.html#timeout_ms" class="tsd-kind-icon"
                  >TIMEOUT_<wbr />MS</a
                >
              </li>
              <li class="tsd-kind-variable">
                <a href="globals.html#provider" class="tsd-kind-icon"
                  >provider</a
                >
              </li>
              <li class="tsd-kind-object-literal">
                <a href="globals.html#network_info" class="tsd-kind-icon"
                  >NETWORK_<wbr />INFO</a
                >
              </li>
              <li class="tsd-kind-object-literal">
                <a href="globals.html#connection" class="tsd-kind-icon"
                  >connection</a
                >
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
    <footer class="with-border-bottom">
      <div class="container">
        <h2>Legend</h2>
        <div class="tsd-legend-group">
          <ul class="tsd-legend">
            <li
              class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"
            >
              <span class="tsd-kind-icon">Inherited property</span>
            </li>
            <li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited">
              <span class="tsd-kind-icon">Inherited method</span>
            </li>
            <li
              class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"
            >
              <span class="tsd-kind-icon">Inherited accessor</span>
            </li>
          </ul>
          <ul class="tsd-legend">
            <li class="tsd-kind-constructor tsd-parent-kind-class">
              <span class="tsd-kind-icon">Constructor</span>
            </li>
            <li class="tsd-kind-method tsd-parent-kind-class">
              <span class="tsd-kind-icon">Method</span>
            </li>
          </ul>
          <ul class="tsd-legend">
            <li class="tsd-kind-property tsd-parent-kind-class tsd-is-private">
              <span class="tsd-kind-icon">Private property</span>
            </li>
            <li class="tsd-kind-method tsd-parent-kind-class tsd-is-private">
              <span class="tsd-kind-icon">Private method</span>
            </li>
          </ul>
          <ul class="tsd-legend">
            <li class="tsd-kind-property tsd-parent-kind-interface">
              <span class="tsd-kind-icon">Property</span>
            </li>
          </ul>
          <ul class="tsd-legend">
            <li class="tsd-kind-method tsd-parent-kind-class tsd-is-static">
              <span class="tsd-kind-icon">Static method</span>
            </li>
          </ul>
        </div>
      </div>
    </footer>
    <div class="container tsd-generator">
      <p>
        Generated using
        <a href="https://typedoc.org/" target="_blank">TypeDoc</a>
      </p>
    </div>
    <div class="overlay"></div>
    <script src="assets/js/main.js"></script>
  </body>
</html>
